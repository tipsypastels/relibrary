# Relibrary
By Group Nine

How to use:
- Start XAMPP.
- Clone this project into your `htdocs` directory.
- Create a `relibrary` database in PHPMyAdmin.
- Make sure your PHPMyAdmin database access settings match those in `lib/database.php`. If not, edit the file accordingly.
- Insert the contents of SETUP.sql (see the filesystem above) into the newly created database.
- Navigate to localhost/relibrary.

## About the Database Interface

Instead of writing SQL by hand with constant `$db->query`s, it's often a lot easier to write a script that will generate that kind of thing for you. For that, I created a simple class called DatabaseModel (`lib/database_model.php`) that handles automatic SQL generation.

Individual database tables, (such as `books`) must define their own classes which `extend DatabaseModel` and automatically get all its functionality. In order to work properly they must define three static methods.

- `table_name` - Must return the name of the table in the database, so that `DatabaseModel` can know what to query.
- `strong_params` - Must return an array of properties that it's okay to use to look up a database row. This is for security reasons, it prevents, for example, looking up Customers by password.
- `required_fields` - **(Optional)** Must return an array of fields that MUST be present before the tuple is inserted into the database. This is an extra layer on top of SQL's `NOT NULL` validation, but because it's easier to do this kind of check in PHP, it's worth the redundancy.

In return for that effort, you get a simple interface that's much more convenient for basic use than hand-written SQL. Of course we are still using SQL, and in some cases we do write it manually, but this is a time save.

A simple example:

```php
class Book extends DatabaseModel {
  public static function table_name() {
    return 'books';
  }

  public static function strong_params() {
    return ['id', 'author_id'];
  }
}
```

```php
# This is equivalent to SELECT *, except instead of simple tuples it converts the results into a Book object.
$books = Book::all();

foreach($books as $book) {
  # To get a column value, such as `name`, simply call it as a method on the Book object.
  echo $book->name();
}
```

### Limitations
The `DatabaseModel` is extremely basic and can only perform queries in one of two formats.

- `SELECT _ FROM _ WHERE _ = _ [LIMIT _]`
- `INSERT INTO _ VALUES (_...)`

Joins, subqueries, aggregates, and other advanced SQL features are not possible, so anywhere they are needed the SQL is written by hand.

## List of SQL Queries
(This includes queries automatically generated by `DatabaseModel`). Because the SQL generation is automatic, it's not possible to paste the exact code used, but the purposes are listed here.

If you want to see the SQL output live, open the browser console. All generated SQL is logged there. Obviously this would not be a good idea in a real application.

### Books
- Select all books.
- Select all book IDs.
- Select all books with a given author.
- Select all books with a given publisher.
- Select all books from a given series.
- Select all books, join author, whose book name or author name matches the user-provided search parameter.
- Select a book by ID.

### Authors
- Select the author of a given book.
- Select an author by ID.

### Series
- Select the series of a given book.
- Select a series by ID.

### Publishers
- Select the publisher of a given book.
- Select a publisher by ID.

### Customers
- Select the customer with a given email and password (to log in).
- Select the user linked to the current browser session.
- Select the full name of the current us.

### Book Rentals
- Insert a book rental with foreign keys to the current customer's ID and the ID of the book being rented.
- View all rentals made by a given customer.
- View the available inventory of a given book, by using COUNT(\*) of rentals and subtracting that from the total number available (which is a column in the `books` table).

### Book Ratings
- Insert a book rating with foreign keys to the current customer's ID and the ID of the book being rated.
- View all ratings of a given book.
- View the average rating of a given book.
- View all ratings left by a given customer.